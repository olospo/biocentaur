$(document).ready(function() {
    var delay = (function() {
        var timer = 0;
        return function(callback, ms) {
            clearTimeout(timer);
            timer = setTimeout(callback, ms);
        };
    })();
    /* ARCHIVE FAQ */
    $("#faq-archive-form .category-buttons input").click(function() {
      faq_ajax($("#faq-archive-form"));
    });

    $("#archive-faq-search").on("keyup search", function() {
      delay(function() {
        faq_ajax($("#faq-archive-form"));
      }, 500);
    });

    $("#faq-archive-form").submit(function(e) {
      e.preventDefault();
      faq_ajax($("#faq-archive-form"));
    });

    /* PAGINATION */
    function pagination_ajax() {
      $("#faq-archive-content .pagination a").click(function(e) {
        e.preventDefault();
        var $page_no = $(this).html();
        faq_ajax($("#faq-archive-form"), $page_no);
      });
    }
    pagination_ajax();

    /* Loading posts content */
    function get_loading_content() {
      return (
        '<div class="page-content" id="loader">' +
        "Loading FAQs" + 
        '<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>' +
        "</div>" 
      );
    }
    

    /* AJAX FUNCTIONS */
    function faq_ajax($form, $page = 1) {
        var $form_data_objs = $form.serializeArray(),
            $form_data = {};
        $.each($form_data_objs, function(i, field) {
            $form_data[field.name] = field.value;
        });
        var $action = $form_data.action,
            $form_id = $form_data.form_id,
            $anchor = $form_data.anchor,
            $nonce = $form_data.faq_search_nonce,
            $category = $form_data.category,
            $searchterm = $form_data.faq_searchterm,
            $content = $("#" + $form_data.content_area_id);

        $.ajax({
            type: "post",
            url: myAjax.ajaxurl,
            data: {
              action: $action,
              faq_search_nonce: $nonce,
              category: $category,
              faq_searchterm: $searchterm,
              anchor: $anchor,
              form_id: $form_id,
              selected_page: $page,
            },
            beforeSend: function() {
              $content.empty();
              $content.append(get_loading_content("faq"));
              console.log($form_data);
            },
            success: function(html) {
              $content.empty();
              $content.append(html);
              accordion_ajax();
            },
            complete: function() {
              pagination_ajax();
            }
        });
    }
});